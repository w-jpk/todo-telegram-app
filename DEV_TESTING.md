# Тестирование в Dev режиме

## Обзор

В dev режиме доступны специальные инструменты и возможности для тестирования проекта во время разработки.

## Быстрый старт

### 1. Запуск dev сервера с тестами

```bash
# Запустить dev сервер и тесты параллельно (требует concurrently)
npm run dev:test

# Или отдельно:
npm run dev          # В одном терминале
npm run test:watch   # В другом терминале
```

### 2. Тестирование компонентов в браузере

1. Запустите dev сервер: `npm run dev`
2. Откройте страницу компонентов: `http://localhost:3002/dev/components`
3. На этой странице доступны:
   - Все состояния компонентов TodoItem
   - Фильтры и списки задач
   - Быстрые контролы (PrioritySelector, DateSelector, ProjectSelector)
   - Модальные окна

### 3. Использование Dev Test Utils в консоли браузера

В dev режиме доступны утилиты через `window.__DEV_TEST_UTILS__`:

```javascript
// Создать тестовую задачу
const todo = __DEV_TEST_UTILS__.createTestTodo({
  text: 'Моя тестовая задача',
  priority: 'high'
})

// Создать тестовый проект
const project = __DEV_TEST_UTILS__.createTestProject({
  name: 'Мой проект',
  color: '#ff0000'
})

// Логировать состояние todos
__DEV_TEST_UTILS__.logTodos(todosArray)

// Очистить хранилище
__DEV_TEST_UTILS__.clearStorage()

// Установить тестового пользователя
__DEV_TEST_UTILS__.setTestUser({
  id: 999999,
  first_name: 'Test',
  username: 'testuser'
})
```

## Команды для dev тестирования

### Unit тесты

```bash
# Watch режим (автоматический перезапуск)
npm run test:watch
# или
npm run test:dev

# С UI интерфейсом
npm run test:ui
# или
npm run test:dev:ui

# С покрытием кода
npm run test:dev:coverage
```

### E2E тесты

```bash
# Обычный запуск
npm run test:e2e

# С UI интерфейсом
npm run test:e2e:ui

# В dev режиме
npm run test:e2e:dev
```

## Структура dev тестирования

```
tests/
├── setup.ts              # Глобальная настройка тестов
├── dev-helpers.ts        # Утилиты для браузерной консоли (dev режим)
├── dev-test-runner.ts    # Утилиты для запуска тестов программно
└── utils/
    └── test-helpers.ts   # Общие утилиты для тестов
```

## Страницы для тестирования

### `/dev/components`
Страница для ручного тестирования компонентов:
- Доступна только в dev режиме
- Показывает все состояния компонентов
- Позволяет интерактивно тестировать функциональность
- Не требует подключения к БД

## Особенности dev режима

### 1. Автоматическая загрузка утилит
При запуске в dev режиме автоматически загружаются тестовые утилиты в браузерную консоль.

### 2. Mock данные
В dev режиме доступны готовые mock данные для тестирования:
- Тестовые пользователи Telegram
- Тестовые задачи
- Тестовые проекты

### 3. Hot Reload для тестов
При использовании `test:watch` тесты автоматически перезапускаются при изменении кода.

### 4. Расширенное логирование
В dev режиме доступно расширенное логирование для отладки:
- Состояние todos
- API запросы
- Ошибки с подробной информацией

## Примеры использования

### Тестирование composable в консоли

```javascript
// В браузерной консоли (dev режим)
const { todos, createTodo } = useTodos()

// Создать тестовую задачу
await createTodo({
  text: 'Тестовая задача',
  priority: 'high'
})

// Проверить результат
console.log(todos.value)
```

### Тестирование компонента

1. Откройте `/dev/components`
2. Используйте интерактивные элементы для тестирования
3. Проверяйте изменения в реальном времени
4. Используйте консоль браузера для отладки

### Отладка тестов

```bash
# Запустить тесты с отладкой
npm run test:ui

# В UI интерфейсе можно:
# - Видеть результаты тестов в реальном времени
# - Фильтровать тесты
# - Запускать отдельные тесты
# - Видеть покрытие кода
```

## Рекомендации

1. **Используйте watch режим** для автоматического перезапуска тестов
2. **Тестируйте в браузере** используя `/dev/components` для быстрой проверки UI
3. **Используйте консольные утилиты** для создания тестовых данных
4. **Проверяйте покрытие** регулярно с помощью `test:dev:coverage`
5. **Пишите тесты параллельно** с разработкой функциональности

## Troubleshooting

### Тесты не запускаются
- Убедитесь, что установлены все зависимости: `npm install`
- Проверьте, что Node.js версии 18+

### Dev утилиты не загружаются
- Убедитесь, что запущен в dev режиме: `npm run dev`
- Проверьте консоль браузера на наличие ошибок
- Убедитесь, что файл `plugins/dev-test-utils.client.ts` существует

### Страница `/dev/components` недоступна
- Убедитесь, что запущен в dev режиме
- Проверьте, что middleware `dev-only` работает корректно

## Дополнительные ресурсы

- [TESTING.md](./TESTING.md) - Полное руководство по тестированию
- [IMPROVEMENTS.md](./IMPROVEMENTS.md) - Рекомендации по улучшению
- [ANALYSIS_REPORT.md](./ANALYSIS_REPORT.md) - Отчет об анализе проекта

